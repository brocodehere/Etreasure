---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { fetchContent } from '../lib/api';

export async function getStaticPaths() {
  // Define all possible policy slugs
  const policySlugs = [
    'privacy-policy',
    'terms-of-service', 
    'refund-policy',
    'shipping-policy'
  ];
  
  // Return paths for all policies
  return policySlugs.map((policy) => ({
    params: { policy }
  }));
}

// Get the policy slug from the URL
const { policy } = Astro.params;

// Fetch the specific policy content
let policyData = null;
let error = null;

try {
  policyData = await fetchContent(policy);
} catch (err) {
  error = err;
  }

// Use fetched data only
const displayPolicy = policyData;

if (!displayPolicy) {
  return Astro.redirect('/policies');
}
---

<Layout title={`${displayPolicy.title} - Ethnic Treasures`}>
  <Header />
  
  <main class="min-h-screen bg-light">
    <!-- Breadcrumb -->
    <section class="bg-gray-50 py-4">
      <div class="container mx-auto px-4">
        <nav class="flex items-center space-x-2 text-sm">
          <a href="/" class="text-gray-600 hover:text-gold transition-colors">Home</a>
          <span class="text-gray-400">/</span>
          <a href="/policies" class="text-gray-600 hover:text-gold transition-colors">Policies</a>
          <span class="text-gray-400">/</span>
          <span class="text-gray-900 font-medium">{displayPolicy.title}</span>
        </nav>
      </div>
    </section>

    <!-- Policy Content -->
    <section class="py-16">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
          <div class="bg-white rounded-lg shadow-lg p-8 md:p-12">
            <h1 class="font-playfair text-3xl md:text-4xl font-bold text-dark mb-6">{displayPolicy.title}</h1>
            
            <div class="prose prose-lg max-w-none">
              <div set:html={displayPolicy.content} />
            </div>

            <!-- Last Updated Notice -->
            <div class="mt-12 pt-8 border-t border-gray-200">
              <p class="text-sm text-gray-500 text-center">
                This policy was last updated on {new Date().toLocaleDateString()}. 
                We may update this policy from time to time.
              </p>
            </div>
          </div>

          <!-- Navigation -->
          <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-between">
            <a 
              href="/policies" 
              class="bg-gray-200 text-dark px-6 py-3 rounded-lg font-medium hover:bg-gray-300 transition-colors duration-200 text-center"
            >
              ‚Üê Back to All Policies
            </a>
            
            <div class="flex gap-4">
              <a 
                href="/contact" 
                class="bg-gold text-dark px-6 py-3 rounded-lg font-medium hover:bg-gold/90 transition-colors duration-200 text-center"
              >
                Contact Support
              </a>
              <a 
                href="/faq" 
                class="bg-dark text-white px-6 py-3 rounded-lg font-medium hover:bg-dark/90 transition-colors duration-200 text-center"
              >
                View FAQ
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Related Policies -->
    {policyData && (
      <section class="bg-gray-50 py-16">
        <div class="container mx-auto px-4">
          <div class="max-w-4xl mx-auto">
            <h2 class="font-playfair text-2xl font-semibold text-dark mb-8 text-center">Other Policies</h2>
            <div class="grid md:grid-cols-2 gap-6">
              <a href="/privacy-policy" class={`bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow duration-300 ${policy === 'privacy-policy' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                <h3 class="font-semibold text-dark mb-2">Disclaimer & Privacy Policy</h3>
                <p class="text-gray-600 text-sm">How we collect, use, and protect your information</p>
              </a>
              <a href="/terms-of-service" class={`bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow duration-300 ${policy === 'terms-of-service' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                <h3 class="font-semibold text-dark mb-2">Terms & Conditions</h3>
                <p class="text-gray-600 text-sm">Terms governing the use of our website and services</p>
              </a>
              <a href="/refund-policy" class={`bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow duration-300 ${policy === 'refund-policy' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                <h3 class="font-semibold text-dark mb-2">Return Policy</h3>
                <p class="text-gray-600 text-sm">Our return and refund guidelines</p>
              </a>
              <a href="/shipping-policy" class={`bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow duration-300 ${policy === 'shipping-policy' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                <h3 class="font-semibold text-dark mb-2">Shipping Policy</h3>
                <p class="text-gray-600 text-sm">Information about shipping methods and timelines</p>
              </a>
            </div>
          </div>
        </div>
      </section>
    )}
  </main>

  <Footer />
</Layout>
