---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { fetchContent } from '../lib/api';

export async function getStaticPaths() {
  // Define all possible policy slugs
  const policySlugs = [
    'privacy-policy',
    'terms-of-service', 
    'refund-policy',
    'shipping-policy'
  ];
  
  // Return paths for all policies
  return policySlugs.map((policy) => ({
    params: { policy }
  }));
}

// Get the policy slug from the URL
const { policy } = Astro.params;

// Fetch the specific policy content
let policyData = null;
let error = null;

try {
  policyData = await fetchContent(policy);
} catch (err) {
  error = err;
  console.error(`Failed to fetch policy ${policy}:`, err);
}

// Fallback content for different policy types
const fallbackContent = {
  'privacy-policy': {
    title: 'Disclaimer & Privacy Policy',
    content: `
      <h2>Privacy Policy</h2>
      <p><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</p>
      
      <h3>Information We Collect</h3>
      <p>We collect information you provide directly to us, such as when you create an account, make a purchase, or contact us for support.</p>
      
      <h3>How We Use Your Information</h3>
      <p>We use the information we collect to provide, maintain, and improve our services, process transactions, and communicate with you.</p>
      
      <h3>Information Sharing</h3>
      <p>We do not sell, trade, or otherwise transfer your personal information to third parties without your consent.</p>
      
      <h3>Data Security</h3>
      <p>We implement appropriate security measures to protect your personal information against unauthorized access.</p>
      
      <h3>Contact Us</h3>
      <p>If you have any questions about this Privacy Policy, please contact us at info@ethnictreasures.co.in</p>
    `
  },
  'terms-of-service': {
    title: 'Terms & Conditions',
    content: `
      <h2>Terms & Conditions</h2>
      <p><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</p>
      
      <h3>Agreement to Terms</h3>
      <p>By accessing and using Ethnic Treasures, you accept and agree to be bound by the terms and provision of this agreement.</p>
      
      <h3>Use License</h3>
      <p>Permission is granted to temporarily download one copy of the materials on Ethnic Treasures for personal, non-commercial transitory viewing only.</p>
      
      <h3>Product Information</h3>
      <p>We strive to be as accurate as possible in the descriptions of our products. However, we do not warrant that product descriptions or other content are accurate, complete, reliable, current, or error-free.</p>
      
      <h3>Pricing and Availability</h3>
      <p>All prices are subject to change without notice. We reserve the right to modify or discontinue a product at any time.</p>
      
      <h3>Limitation of Liability</h3>
      <p>In no event shall Ethnic Treasures or its suppliers be liable for any damages (including, without limitation, damages for loss of data or profit, or due to business interruption) arising out of the use or inability to use the materials on our website.</p>
    `
  },
  'refund-policy': {
    title: 'Return Policy',
    content: `
      <h2>Return Policy</h2>
      <p><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</p>
      
      <h3>Return Period</h3>
      <p>You may return most new, unopened items within 7 days of delivery for a full refund.</p>
      
      <h3>Return Conditions</h3>
      <p>To be eligible for a return, your item must be unused and in the same condition that you received it. It must also be in the original packaging.</p>
      
      <h3>Refund Process</h3>
      <p>Once we receive your returned item, we will inspect it and notify you of the approval or rejection of your refund. If approved, your refund will be processed and a credit will be applied to your original method of payment.</p>
      
      <h3>Non-Returnable Items</h3>
      <p>Certain items cannot be returned, including perishable goods, custom products, and intimate or sanitary goods.</p>
      
      <h3>Shipping Costs</h3>
      <p>You will be responsible for paying for your own shipping costs for returning your item. Shipping costs are non-refundable.</p>
    `
  },
  'shipping-policy': {
    title: 'Shipping Policy',
    content: `
      <h2>Shipping Policy</h2>
      <p><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</p>
      
      <h3>Processing Time</h3>
      <p>Orders are typically processed within 1-2 business days. You will receive a confirmation email once your order has been shipped.</p>
      
      <h3>Shipping Methods</h3>
      <p>We offer various shipping methods including standard shipping (5-7 business days) and express shipping (2-3 business days).</p>
      
      <h3>Shipping Costs</h3>
      <p>Shipping costs are calculated based on your location and the shipping method selected. Free shipping is available on orders above a certain amount.</p>
      
      <h3>International Shipping</h3>
      <p>We currently ship within India. International shipping options may be available in the future.</p>
      
      <h3>Delivery Issues</h3>
      <p>If you haven't received your order within the expected timeframe, please contact us at info@ethnictreasures.co.in and we'll assist you in tracking your package.</p>
    `
  }
};

// Use fetched data or fallback
const displayPolicy = policyData || fallbackContent[policy as keyof typeof fallbackContent];

if (!displayPolicy) {
  return Astro.redirect('/policies');
}
---

<Layout title={`${displayPolicy.title} - Ethnic Treasures`}>
  <Header />
  
  <main class="min-h-screen bg-light">
    <!-- Breadcrumb -->
    <section class="bg-gray-50 py-4">
      <div class="container mx-auto px-4">
        <nav class="flex items-center space-x-2 text-sm">
          <a href="/" class="text-gray-600 hover:text-gold transition-colors">Home</a>
          <span class="text-gray-400">/</span>
          <a href="/policies" class="text-gray-600 hover:text-gold transition-colors">Policies</a>
          <span class="text-gray-400">/</span>
          <span class="text-gray-900 font-medium">{displayPolicy.title}</span>
        </nav>
      </div>
    </section>

    <!-- Policy Content -->
    <section class="py-16">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
          <div class="bg-white rounded-lg shadow-lg p-8 md:p-12">
            <h1 class="font-playfair text-3xl md:text-4xl font-bold text-dark mb-6">{displayPolicy.title}</h1>
            
            <div class="prose prose-lg max-w-none">
              <div set:html={displayPolicy.content} />
            </div>

            <!-- Last Updated Notice -->
            <div class="mt-12 pt-8 border-t border-gray-200">
              <p class="text-sm text-gray-500 text-center">
                This policy was last updated on {new Date().toLocaleDateString()}. 
                We may update this policy from time to time.
              </p>
            </div>
          </div>

          <!-- Navigation -->
          <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-between">
            <a 
              href="/policies" 
              class="bg-gray-200 text-dark px-6 py-3 rounded-lg font-medium hover:bg-gray-300 transition-colors duration-200 text-center"
            >
              ‚Üê Back to All Policies
            </a>
            
            <div class="flex gap-4">
              <a 
                href="/contact" 
                class="bg-gold text-dark px-6 py-3 rounded-lg font-medium hover:bg-gold/90 transition-colors duration-200 text-center"
              >
                Contact Support
              </a>
              <a 
                href="/faq" 
                class="bg-dark text-white px-6 py-3 rounded-lg font-medium hover:bg-dark/90 transition-colors duration-200 text-center"
              >
                View FAQ
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Related Policies -->
    {policyData && (
      <section class="bg-gray-50 py-16">
        <div class="container mx-auto px-4">
          <div class="max-w-4xl mx-auto">
            <h2 class="font-playfair text-2xl font-semibold text-dark mb-8 text-center">Other Policies</h2>
            <div class="grid md:grid-cols-2 gap-6">
              <a href="/privacy-policy" class={`bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow duration-300 ${policy === 'privacy-policy' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                <h3 class="font-semibold text-dark mb-2">Disclaimer & Privacy Policy</h3>
                <p class="text-gray-600 text-sm">How we collect, use, and protect your information</p>
              </a>
              <a href="/terms-of-service" class={`bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow duration-300 ${policy === 'terms-of-service' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                <h3 class="font-semibold text-dark mb-2">Terms & Conditions</h3>
                <p class="text-gray-600 text-sm">Terms governing the use of our website and services</p>
              </a>
              <a href="/refund-policy" class={`bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow duration-300 ${policy === 'refund-policy' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                <h3 class="font-semibold text-dark mb-2">Return Policy</h3>
                <p class="text-gray-600 text-sm">Our return and refund guidelines</p>
              </a>
              <a href="/shipping-policy" class={`bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow duration-300 ${policy === 'shipping-policy' ? 'opacity-50 cursor-not-allowed' : ''}`}>
                <h3 class="font-semibold text-dark mb-2">Shipping Policy</h3>
                <p class="text-gray-600 text-sm">Information about shipping methods and timelines</p>
              </a>
            </div>
          </div>
        </div>
      </section>
    )}
  </main>

  <Footer />
</Layout>
