---
// Enhanced Bestsellers section with dynamic data from API
import Layout from '../layouts/Layout.astro';
---

<script>
	// Fetch bestsellers from API
	async function fetchBestsellers() {
		try {
			const response = await fetch('https://etreasure-1.onrender.com/api/public/products?bestseller=true&limit=10');
			const data = await response.json();
			return data.products || [];
		} catch (error) {
			console.error('Failed to fetch bestsellers:', error);
			// No fallback data - if API fails, show no bestsellers
			return [];
		}
	}

	// Render bestsellers
	async function renderBestsellers() {
		const bestsellers = await fetchBestsellers();
		const container = document.getElementById('bestsellers-container');
		
		if (container) {
			container.innerHTML = bestsellers.map((product, index) => `
				<div 
					class="flex-none w-80 group/card animate-fade-up" 
					style="animation-delay: ${index * 0.15}s;"
				>
					<!-- Enhanced Product Card -->
					<div class="relative bg-white rounded-2xl shadow-card hover:shadow-card-hover transition-all duration-500 transform hover:-translate-y-2 border border-gold/20 overflow-hidden">
						<div class="relative overflow-hidden h-80">
							<!-- Product Image with Enhanced Effects -->
							<picture>
								<source srcset="${product.image.replace('.webp', '-600.avif')}" type="image/avif">
								<source srcset="${product.image.replace('.webp', '-600.webp')}" type="image/webp">
								<img 
									src="${product.image}" 
									alt="${product.name}"
									class="w-full h-full object-cover transition-transform duration-700 group-hover/card:scale-110"
									loading="lazy"
								/>
							</picture>
							
							<!-- Enhanced Badge System -->
							<div class="absolute top-4 left-4 flex flex-col gap-2">
								<span class="px-3 py-1.5 text-xs font-bold rounded-full backdrop-blur-sm border ${
									product.badge === 'Bestseller' ? 'bg-gold/90 text-white border-gold' :
									product.badge === 'New' ? 'bg-green-500/90 text-white border-green-500' :
									product.badge === 'Limited' ? 'bg-red-500/90 text-white border-red-500' :
									'bg-maroon/90 text-white border-maroon'
								} shadow-lg animate-pulse">
									${product.badge}
								</span>
								${product.isNew ? `
									<span class="bg-gradient-to-r from-gold to-maroon text-white px-3 py-1.5 text-xs font-bold rounded-full shadow-lg animate-gold-shine">
										Just In
									</span>
								` : ''}
							</div>
							
							<!-- Discount Badge -->
							${product.discount ? `
								<div class="absolute top-4 right-4">
									<span class="bg-red-500 text-white px-3 py-1.5 text-sm font-bold rounded-full shadow-lg border-2 border-white">
										-${product.discount}%
									</span>
								</div>
							` : ''}

							<!-- Enhanced Quick Actions Overlay -->
							<div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-0 group-hover/card:opacity-100 transition-all duration-300 flex flex-col justify-between p-6">
								<div class="flex justify-between items-start">
									<!-- Color Options -->
									<div class="flex gap-1">
										${product.colors.map((color, i) => `
											<div class="w-6 h-6 rounded-full border-2 border-white shadow-md" style="background-color: ${color};"></div>
										`).join('')}
									</div>
									<!-- Wishlist Button -->
									<button class="bg-white/90 backdrop-blur-sm p-2 rounded-full hover:bg-white transition-colors duration-200 shadow-lg">
										<svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
											<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
										</svg>
									</button>
								</div>
								
								<div class="flex flex-col gap-3">
									<button class="btn-primary text-sm shadow-gold hover:shadow-gold-hover transform hover:scale-105 transition-all duration-200">
										Quick View
									</button>
									<button class="bg-white text-maroon px-4 py-2 text-sm font-semibold rounded-lg hover:bg-gold hover:text-white transition-all duration-200 shadow-lg transform hover:scale-105">
										Add to Cart
									</button>
								</div>
							</div>
						</div>

						<!-- Enhanced Product Info -->
						<div class="p-6 space-y-4">
							<div class="flex items-start justify-between">
								<div class="flex-1">
									<span class="text-xs text-gold font-semibold tracking-widest uppercase mb-1 block">${product.category}</span>
									<h3 class="font-playfair text-xl font-bold text-maroon mb-2 group-hover/card:text-gold transition-colors duration-300">
										${product.name}
									</h3>
								</div>
							</div>
							
							<!-- Enhanced Rating -->
							<div class="flex items-center gap-3">
								<div class="flex items-center gap-1">
									<div class="flex text-gold">
										${Array.from({ length: 5 }, (_, i) => `
											<svg class="w-4 h-4 ${i < Math.floor(product.rating) ? 'fill-current' : 'fill-gray-300'}" viewBox="0 0 20 20">
												<path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
											</svg>
										`).join('')}
									</div>
									<span class="text-sm font-semibold text-dark/80">${product.rating}</span>
								</div>
								<span class="text-sm text-dark/60">(${product.reviews} reviews)</span>
							</div>

							<!-- Enhanced Price Section -->
							<div class="flex items-center justify-between">
								<div class="flex items-center gap-3">
									<div>
										<span class="text-2xl font-bold text-maroon">${product.price}</span>
										<span class="text-sm text-dark/60 line-through ml-2">${product.originalPrice}</span>
									</div>
								</div>
								${product.discount ? `
									<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-semibold">
										Save ${product.discount}%
									</span>
								` : ''}
							</div>

							<!-- Enhanced Action Buttons -->
							<div class="flex gap-3">
								<a href="${product.href}" class="btn-primary flex-1 text-center py-3 text-sm font-semibold shadow-gold hover:shadow-gold-hover transform hover:scale-105 transition-all duration-200">
									View Details
								</a>
								<button class="bg-maroon/10 text-maroon p-3 rounded-lg hover:bg-maroon hover:text-white transition-all duration-200 shadow-md transform hover:scale-105">
									<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
									</svg>
								</button>
							</div>
						</div>
					</div>
				</div>
			`).join('');
		}
	}

	// Initialize bestsellers when DOM is loaded
	document.addEventListener('DOMContentLoaded', renderBestsellers);
</script>
---

<section class="relative py-20 bg-gradient-to-br from-cream via-white to-cream overflow-hidden">
	<!-- Background Decorative Elements -->
	<div class="absolute inset-0 opacity-5">
		<div class="absolute top-20 left-20 w-64 h-64 bg-gold rounded-full blur-3xl animate-pulse"></div>
		<div class="absolute bottom-20 right-20 w-96 h-96 bg-maroon rounded-full blur-3xl animate-pulse" style="animation-delay: 2s"></div>
		<div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-gold/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s"></div>
	</div>
	
	<div class="container mx-auto px-4 relative z-10">
		<!-- Section Header -->
		<div class="text-center mb-16 animate-fade-in">
			<div class="inline-flex items-center gap-2 mb-6">
				<div class="h-px bg-gradient-to-r from-transparent to-gold w-20"></div>
				<span class="text-gold font-playfair text-sm tracking-widest uppercase">Featured Collection</span>
				<div class="h-px bg-gradient-to-l from-transparent to-gold w-20"></div>
			</div>
			
			<h2 class="font-playfair text-5xl md:text-6xl font-bold text-gradient mb-6">
				Bestsellers
			</h2>
			
			<div class="flex items-center justify-center gap-4 mb-8">
				<div class="w-16 h-0.5 bg-gold shadow-gold"></div>
				<div class="w-2 h-2 bg-gold rounded-full shadow-gold animate-pulse"></div>
				<div class="w-16 h-0.5 bg-gold shadow-gold"></div>
			</div>
			
			<p class="text-lg md:text-xl text-dark/80 max-w-3xl mx-auto leading-relaxed font-light">
				Discover our most coveted pieces, cherished by discerning customers worldwide. Each creation tells a story of <span class="text-maroon font-semibold">heritage craftsmanship</span> and <span class="text-gold font-semibold">timeless elegance</span>.
			</p>
		</div>

		<!-- Enhanced Horizontal Scroll Container -->
		<div class="relative group">
			<!-- Gradient Fade Edges -->
			<div class="absolute left-0 top-0 bottom-0 w-20 bg-gradient-to-r from-cream to-transparent z-20 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
			<div class="absolute right-0 top-0 bottom-0 w-20 bg-gradient-to-l from-cream to-transparent z-20 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
			
			<div class="flex gap-8 overflow-x-auto pb-8 scrollbar-hide scroll-smooth px-4" id="bestsellers-container">
				<!-- Products will be dynamically loaded here -->
			</div>

			<!-- Enhanced Scroll Navigation -->
			<button 
				id="scroll-left"
				class="absolute left-0 top-1/2 -translate-y-1/2 bg-white/95 backdrop-blur-sm text-maroon p-3 rounded-full shadow-xl hover:bg-gold hover:text-white transition-all duration-300 -translate-x-4 lg:translate-x-0 opacity-0 group-hover:opacity-100 transform hover:scale-110 z-30 border border-gold/20"
			>
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
				</svg>
			</button>
			<button 
				id="scroll-right"
				class="absolute right-0 top-1/2 -translate-y-1/2 bg-white/95 backdrop-blur-sm text-maroon p-3 rounded-full shadow-xl hover:bg-gold hover:text-white transition-all duration-300 translate-x-4 lg:translate-x-0 opacity-0 group-hover:opacity-100 transform hover:scale-110 z-30 border border-gold/20"
			>
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
				</svg>
			</button>
		</div>

		<!-- Enhanced Call-to-Action Section -->
		<div class="mt-12 animate-fade-up">
			<!-- Decorative Divider -->
			<div class="flex items-center justify-center mb-8">
				<div class="h-px bg-gradient-to-r from-transparent via-gold/50 to-transparent w-full max-w-md"></div>
				<div class="mx-4">
					<div class="w-8 h-8 bg-gold/20 rounded-full flex items-center justify-center">
						<div class="w-3 h-3 bg-gold rounded-full animate-pulse"></div>
					</div>
				</div>
				<div class="h-px bg-gradient-to-r from-gold/50 to-transparent w-full max-w-md"></div>
			</div>
			
			<!-- Main CTA Container -->
			<div class="text-center space-y-6">
				<!-- Primary CTA with Enhanced Design -->
				<div class="inline-block">
					<a href="/bestsellers" class="group relative inline-flex items-center gap-3 bg-gradient-to-r from-maroon to-maroon/90 text-white px-8 py-4 rounded-full font-semibold text-lg shadow-gold hover:shadow-gold-hover transform hover:scale-105 transition-all duration-300 border border-gold/30">
						<!-- Background Glow Effect -->
						<div class="absolute inset-0 bg-gradient-to-r from-gold/20 to-transparent rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
						
						<!-- Icon -->
						<svg class="w-5 h-5 transform group-hover:rotate-12 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
						</svg>
						
						<span class="relative z-10">View All Bestsellers</span>
						
						<!-- Arrow Icon -->
						<svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
						</svg>
					</a>
				</div>
				
				<!-- Secondary CTA -->
				<div class="flex items-center justify-center gap-2 text-sm">
					<span class="text-dark/60">or</span>
					<a href="/shop" class="text-gold hover:text-maroon font-semibold transition-colors duration-200 underline decoration-2 underline-offset-4 hover:underline-offset-2">
						Explore All Products
					</a>
				</div>
				
				<!-- Additional Info -->
				<div class="flex items-center justify-center gap-6 text-xs text-dark/50 mt-4">
					<div class="flex items-center gap-1">
						<svg class="w-4 h-4 text-gold" fill="currentColor" viewBox="0 0 20 20">
							<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
						</svg>
						<span>Premium Quality</span>
					</div>
					<div class="flex items-center gap-1">
						<svg class="w-4 h-4 text-gold" fill="currentColor" viewBox="0 0 20 20">
							<path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
						</svg>
						<span>Handcrafted</span>
					</div>
					<div class="flex items-center gap-1">
						<svg class="w-4 h-4 text-gold" fill="currentColor" viewBox="0 0 20 20">
							<path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
							<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
						</svg>
						<span>Free Shipping</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Enhanced Scroll Script -->
	<script>
		let bestsellersContainer;
		let scrollLeftBtn;
		let scrollRightBtn;
		
		document.addEventListener('DOMContentLoaded', () => {
			bestsellersContainer = document.getElementById('bestsellers-container');
			scrollLeftBtn = document.getElementById('scroll-left');
			scrollRightBtn = document.getElementById('scroll-right');
			
			// Add event listeners to scroll buttons
			if (scrollLeftBtn) {
				scrollLeftBtn.addEventListener('click', () => scrollContainer('left'));
			}
			if (scrollRightBtn) {
				scrollRightBtn.addEventListener('click', () => scrollContainer('right'));
			}
		});
		
		function scrollContainer(direction) {
			if (!bestsellersContainer) return;
			
			const scrollAmount = 400;
			
			if (direction === 'left') {
				bestsellersContainer.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
			} else {
				bestsellersContainer.scrollBy({ left: scrollAmount, behavior: 'smooth' });
			}
		}
		
		// Add keyboard navigation
		document.addEventListener('keydown', (e) => {
			if (!bestsellersContainer) return;
			
			if (e.key === 'ArrowLeft') {
				scrollContainer('left');
			} else if (e.key === 'ArrowRight') {
				scrollContainer('right');
			}
		});
	</script>
</section>
